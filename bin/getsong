#!/usr/bin/env node
// Generated by LiveScript 1.5.0
(function(){
  var process, fs, ref$, exec, mkdir, ls, rm, mv, main;
  process = require('process');
  fs = require('fs');
  ref$ = require('shelljs'), exec = ref$.exec, mkdir = ref$.mkdir, ls = ref$.ls, rm = ref$.rm, mv = ref$.mv;
  main = function(){
    var title, author, query, outfile, basename, metadata_options, newname;
    title = process.argv[2];
    author = process.argv[3];
    if (title == null) {
      console.log('need to provide a search query or url');
      console.log('usage (specifying title author will set metadata correctly):');
      console.log('');
      console.log("getsong 'some search query'");
      console.log("getsong 'title' 'author'");
      return;
    }
    if (author != null) {
      query = title + ' ' + author;
    } else {
      query = title;
    }
    if (fs.existsSync('getsongtmp')) {
      rm('-r', 'getsongtmp');
    }
    mkdir('getsongtmp');
    process.chdir('getsongtmp');
    exec("you-get --itag=18 '" + query + "'");
    outfile = ls('*.mp4').stdout.trim();
    basename = outfile.substr(0, outfile.length - 4);
    mv(outfile, 'tmp.mp4');
    metadata_options = "-metadata title='" + basename + "' -metadata artist='Unknown'";
    if (author != null) {
      metadata_options = "-metadata title='" + title + "' -metadata artist='" + author + "'";
    }
    exec("ffmpeg -i tmp.mp4 -acodec copy -vn " + metadata_options + " audio.m4a");
    newname = basename + '.m4a';
    mv('audio.m4a', '../' + newname);
    process.chdir('..');
    rm('-r', 'getsongtmp');
    return console.log(newname);
  };
  main();
}).call(this);
